# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a SQL query that retrieve all the columns from the table "Grades", where the grade is equal to the maximum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

![Screenshot 2025-05-09 091323](https://github.com/user-attachments/assets/84e3963a-ce4a-4461-b8d1-0d729dbff0e2)

**QUERY:**

```sql

SELECT *
FROM grades
WHERE (subject, grade) IN (
    SELECT subject, MAX(grade)
    FROM grades
    GROUP BY subject
);

```

**Output:**

![Screenshot 2025-05-09 091342](https://github.com/user-attachments/assets/16fc255a-e411-41e3-90d5-87d820a9c7a4)


**Question 2**
---
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

![Screenshot 2025-05-09 091410](https://github.com/user-attachments/assets/dd7beff3-4e5d-4124-8b5f-01043c5fce5b)

**QUERY:**

```sql

SELECT o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
from orders o
join salesman s
on o.salesman_id=s.salesman_id
where s.city='New York';

```

**Output:**

![Screenshot 2025-05-09 091452](https://github.com/user-attachments/assets/9d84f01b-e243-440a-8ce9-b4e96074a8ce)

**Question 3**
---
From the following tables, write a SQL query to find all the orders issued by the salesman 'Paul Adam'. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

![Screenshot 2025-05-09 091520](https://github.com/user-attachments/assets/06e7318e-384e-4d02-8df9-459a4947270d)

**QUERY:**

```sql

SELECT ord_no, purch_amt, ord_date, customer_id, salesman_id
FROM orders
WHERE salesman_id = (
    SELECT salesman_id
    FROM salesman
    WHERE name = 'Paul Adam'
);

```

**Output:**

![Screenshot 2025-05-09 091612](https://github.com/user-attachments/assets/b848dfc8-ee14-4efe-aa8e-fac01524da0c)


**Question 4**
---
 Write a SQL query that retrieves the all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

![Screenshot 2025-05-09 091653](https://github.com/user-attachments/assets/b08521d0-1ca8-4702-bbf6-b529a1b43caf)

**QUERY:**

```sql

select student_id ,student_name,subject,grade
from GRADES g1
where grade=(
select min(grade)
from GRADES g2
where g2.subject=g1.subject
);
```

**Output:**

![Screenshot 2025-05-09 091713](https://github.com/user-attachments/assets/8a0188c1-f69d-4b9a-940b-7c34442212d9)

**Question 5**
---
From the following tables, write a SQL query to find all the orders generated in New York city. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

![Screenshot 2025-05-09 091737](https://github.com/user-attachments/assets/67d51690-6f0a-46c5-90d6-4299c3d84135)

**QUERY:**

```sql

SELECT ord_no, purch_amt, ord_date, customer_id, salesman_id
FROM orders
WHERE salesman_id IN (
    SELECT salesman_id
    FROM salesman
    WHERE city = 'New York'
);

```

**Output:**

![Screenshot 2025-05-09 091758](https://github.com/user-attachments/assets/49051c68-5ce7-4c31-a933-caa22f18a847)


**Question 6**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 2.5 Lakh

![Screenshot 2025-05-09 091821](https://github.com/user-attachments/assets/707d3a10-9825-4d28-a1ca-af5744d124a7)

**QUERY:**

```sql

SELECT id, name, age, city, income
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 250000
);

```

**Output:**

![Screenshot 2025-05-09 091841](https://github.com/user-attachments/assets/8155fe6b-270f-4225-8016-d70b4cba16a2)


**Question 7**
---
From the following tables, write a SQL query to find those salespeople who earned the maximum commission. Return ord_no, purch_amt, ord_date, and salesman_id.

![Screenshot 2025-05-09 091924](https://github.com/user-attachments/assets/b3e454b6-6bf3-4d38-b81a-4f7a6f599521)

**QUERY:**

```sql
SELECT ord_no, purch_amt, ord_date, salesman_id
FROM orders
WHERE salesman_id IN (
    SELECT salesman_id
    FROM salesman
    WHERE commission = (
        SELECT MAX(commission)
        FROM salesman
    )
);

```

**Output:**

![Screenshot 2025-05-09 091945](https://github.com/user-attachments/assets/52ed19ca-f12d-430a-8e30-670cabc87ee8)


**Question 8**
---
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

![Screenshot 2025-05-09 092006](https://github.com/user-attachments/assets/ea16acd0-4719-4118-8d6d-bda3b5b679e4)

**QUERY:**

```sql

SELECT ord_no, purch_amt, ord_date, salesman_id
FROM orders
WHERE salesman_id IN (
    SELECT salesman_id
    FROM salesman
    WHERE commission = (
        SELECT MAX(commission)
        FROM salesman
    )
);

```

**Output:**

![Screenshot 2025-05-09 092033](https://github.com/user-attachments/assets/2c31aa9c-34f7-4f31-98f1-17e21df1a3d1)


**Question 9**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 1 million

![Screenshot 2025-05-09 092128](https://github.com/user-attachments/assets/2461b738-1ac6-4e4f-9f2b-74df1f472f5f)

**QUERY:**
```sql

SELECT id, name, age, city, income
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 1000000
);


```

**Output:**

![Screenshot 2025-05-09 092149](https://github.com/user-attachments/assets/8abf9b5e-8302-4249-b3c2-992519c70a0e)


**Question 10**
---
Write a SQL query to List departments with names longer than the average length

![Screenshot 2025-05-09 092209](https://github.com/user-attachments/assets/187aca71-b6c3-47e6-a9d7-0fb760c9ebdc)

**QUERY:**
```sql

SELECT department_id, department_name
FROM Departments
WHERE LENGTH(department_name) > (
    SELECT AVG(LENGTH(department_name))
    FROM Departments
);

```

**Output:**

![Screenshot 2025-05-09 092228](https://github.com/user-attachments/assets/7f0a4460-10b7-4098-b8a5-19c59d9632d7)

## Module 5 - Home Challenge

![Screenshot 2025-05-09 153912](https://github.com/user-attachments/assets/3e97a888-6454-4806-93c6-cdbfeb586162)


## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
